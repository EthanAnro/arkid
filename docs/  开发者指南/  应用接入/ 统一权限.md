# 统一权限
arkid支持第三方应用，通过输出自身的接口文档，arkid这边通过读取应用本身接口文档，可以在arkid中方便灵活的管理权限。

## 接入步骤

1.需要准备一个可以读取的openapi.json访问地址，json中至少要有permissions节点，permissions中要含有基础的角色信息，以及接口信息。下面提供了一个含有permissions节点的例子，可以作为参考:

``` json
{
    "permissions":[
        {
            "name":"customer",
            "sort_id":0,
            "type":"group",
            "container":[
                3,
                6
            ]
        },
        {
            "name":"tenant-admin",
            "sort_id":1,
            "type":"group",
            "container":[
                4
            ]
        },
        {
            "name":"platform-admin",
            "sort_id":2,
            "type":"group",
            "container":[
                5
            ]
        },
        {
            "name":"app列表",
            "sort_id":3,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_list_apps"
        },
        {
            "name":"创建应用",
            "sort_id":4,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_create_app"
        },
        {
            "name":"公开app列表",
            "sort_id":5,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_list_open_apps"
        },
        {
            "name":"获取app",
            "sort_id":6,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_get_app"
        }
    ]
}
```

| 参数名称        | 参数说明           |
| :---------:    | :--------------: |
| `name`    | 名称  |         
| `sort_id` | 排序id(开发者自行生成) |
| `type` | 类型(api 或 group) |
| `container` | 包含接口的sort_id(只有在group类型中才有值) |
| `operation_id` | 操作id(只有api类型才有这个字段) |

2.需要在应用管理菜单下的应用列表，新建一个应用

[![vlq2Ct.md.jpg](https://s1.ax1x.com/2022/08/09/vlq2Ct.md.jpg)](https://imgtu.com/i/vlq2Ct)

3.需要对应用进行协议配置，这里以OIDC类型的应用为例

[![vlL1RP.md.jpg](https://s1.ax1x.com/2022/08/09/vlL1RP.md.jpg)](https://imgtu.com/i/vlL1RP)

4.需要对应用进行开放API配置

[![vlLysU.md.jpg](https://s1.ax1x.com/2022/08/09/vlLysU.md.jpg)](https://imgtu.com/i/vlLysU)

``` title="补充说明"
如果接口文档中的permissions内容有变更，需要更改应用版本，第一次配置时除外
```
## 如何使用

1.可以在权限管理菜单下，授权管理菜单下的所有应用页面中，把已经读取到的权限，授权给其它租户的人使用。

[![vljsQP.md.jpg](https://s1.ax1x.com/2022/08/09/vljsQP.md.jpg)](https://imgtu.com/i/vljsQP)

``` title="补充说明"
权限的分配是逐级向下的，一般授权开启时，除要开启的权限外，会打开应用入口权限，防止其它租户的用户无法进行登录
授权开启:该权限被授权给其它租户使用，其它租户的管理员是最先拥有该权限的，其它租户管理员可以对自己拥有的权限进行二次分配。
授权关闭:该权限如果从开启状态切换到关闭状态，则已经分配给其它租户的权限，将被收回，包括其它租户二次分配的。
```

2.除了授权给其它租户使用外，也可以在本租户内，进行用户权限赋予

[![vlvrtJ.md.jpg](https://s1.ax1x.com/2022/08/09/vlvrtJ.md.jpg)](https://imgtu.com/i/vlvrtJ)

3.如何获取用户的权限字符串

- 请求地址: `/api/v1/tenant/{tenant_id}/permissionstr`
- 请求方式: GET
- 请求头参数:

| 参数名称        | 参数说明           | 示例           |
| :---------:    | :--------------: | :--------------: |
| `Authorization`  | arkid的用户token  |  Token xxxxx

- 请求参数:

| 参数名称        | 参数说明           | 示例           |
| :---------:    | :--------------: | :--------------: |
| `app_id`    | 应用id  | 从应用编辑页取得

- 返回参数:

| 参数名称        | 参数说明           | 示例           |
| :---------:    | :--------------: | :--------------: |
| `result`    | 用户权限字符串(1是有权限，0是没权限，每位与接口文档中的sort_id对应)  |

- 返回示例: 
``` json
{
    "result":"11111"
}
```