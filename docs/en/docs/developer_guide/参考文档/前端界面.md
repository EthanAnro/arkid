# Front-end interface

!!! Info "Tips"
    1. Hopefully you have read the OpenAPI-Plus documentation before reading it
    2. You have used or browsed the ArkID frontend interface

  The front-end interface mainly includes the following modules:

* [Login screen] (# _ 2)

* [Front End Address Screen] (# _ 5)

* [Function interface] (# _ 6)

## Login interface

  The login interface is mainly generated by `/api/v1/tenant/{tenant_id}/login_page/` the page description information returned by the interface.

  The contents returned by the login interface configuration interface include two items, as shown in the following table. An example picture is shown below.

| 关键字 | 名称 |A detailed description|
| --- | --- | --- |
| data | [页面项配置](#_3) |Rendering different page forms such as login/registration|
| tenant |[租户信息](#_4)| 渲染租户图标和名称等 |

[![vVLQyt.png](https://s1.ax1x.com/2022/08/03/vVLQyt.png)](https://imgtu.com/i/vVLQyt)

### Page item configuration

  The page item configuration information can be dynamically added by `认证因素` the module. By default, there is information such as user name, password, login page configuration, etc. As shown in the figure above, the page item configuration generates all the different form items and button actions in the login module. The main page items are login page, registration page and forgotten password page. Since the rendering process of the three page items is the same, only the generation process of the login page item and the matters needing attention are introduced here.

  The value corresponding to the data keyword is the respective page description information of the page items, and each item contains `forms bottoms extend name` the same field information.

|Keyword| 名称 |
| --- | --- |
| name |Page configuration item name|
| forms |Forms in different ways|
|bottoms| 表单底部操作 |
|extend| 第三方登录 |

** Form item forms **

  Forms is used to render form items in different ways. For example, there can be ① user name and password login mode; ② SMS verification code login mode, etc. Which in turn contains `label items submit` such field information.

|Keyword| 详情 |
| --- | --- |
| label |Form Item Title Name|
| items |Detailed description of each form item|
| submit |Submission action expression of form item|


  Items form item is used to display and input user name, password, mobile phone number and other information, and has the function of sending verification code and other operations.

|Keyword| 含义 | 详情 |
| --- | --- | --- |
| name | 字段key |Returned key when submitting|
| type | 表单项类型 |① text ② password ③ hidden|
|placeholder| 表单项占位符 | - |
|readonly| 表单项只读 | - |
| append | 后缀操作 |See the operation instructions of submit, which is commonly used for operations such as "sending verification code" and "graphic verification code".|

  Submit is the items information entered by the submitting user.

|Keyword| 详情 |
| --- | --- |
| http |Button operation content, including URL/path/params, etc.|
| title |Name of the button action|
| redirect |Redirect address after click|
|agreement| 注册协议说明 |
| delay |Time delay, used to send verification code and other operations|
| gopage |Page name, used to go to a page in data|
| img |Picture address, icon display for third party login|
| long |Boolean, long type button, used to control the length of the button|
| prepend |Button prefix text, often used for buttons at the bottom of a form|
| tooltip |The button moves into the description of the prompt information, which is often used for the third party login button.|


** Operate bottoms **

  This is used to switch back and forth between configuration items on different pages.

  In the front-end page presentation, buttons such as and `忘记密码` are commonly used `还没有账号，立即注册`. Operational attributes of this type typically include attributes `prepend gopage` such as those described above.

** Third-party login extend **

  The extend exists only in the login page configuration item and is used to display different third-party login items. Represented in the picture above as multiple icons below.

  The extend consists of `title buttons` two items. Title is the title; buttons is the button configuration for each third-party login.

  The operation attribute in buttons generally contains `img redirect tooltip` such attribute information.

** Configuration example **

  Examples of information returned by data in the interface are as follows:

```json
{
  "data": {
    "login": {
      "name": "login",
      "forms": [
        {
          "label": "用户名密码登录",
          "items": [
            {
              "value": "",
              "type": "text",
              "name": "username",
              "placeholder": "用户名",
            },
            {
              "value": "",
              "type": "password",
              "name": "password",
              "placeholder": "密码",
            },
          ],
          "submit": {
            "http": {
              "url": "/api/v1/xxx",
              "method": "post",
              "params": null,
            },
            "title": "登录",
            "long": true,
          },
        }
      ],
      "bottoms": [
        {
          "prepend": "还没有账号，",
          "gopage": "register",
          "title": "立即注册",
        },
        {
          "prepend": null,
          "gopage": "password",
          "title": "忘记密码",
        },
      ],
      "extend": {
        "title": "第三方登录",
        "buttons": [
          {
            "img": "xxx.png",
            "redirect": {
              "url": "xxx",
              "params": null,
            },
            "tooltip": "Github",
          },
          {
            "img": "xxx.png",
            "redirect": {
              "url": "xxx",
              "params": null,
            },
            "tooltip": "Gitee",
          }
        ],
      },
    },
    "register": {},
    "password": {},
  }
}
```

### Tenant information

  Tenant information mainly returns the information of the tenant currently logged in. Render the tenant icon and tenant name above the form in the image above.

!!! Login prompt
    1. Login page uses platform tenant login by default
    2. If you want to use another existing tenant to log in, please fill in the suffix information in the address bar, for example: `/login?tenant_id=123`


## Front-end address interface

  This page exists solely to match possible tenant slugs.

  The front-end address interface is shown in the following figure:

  [![v1AlJf.png](https://s1.ax1x.com/2022/08/09/v1AlJf.png)](https://imgtu.com/i/v1AlJf)


!!! Attention "Instructions for use"
    1. The address must include the protocol, domain name, and port. Like, for instance `https://arkidv2.dev.longguikeji.com`
    2. If the input address contains spaces at both ends, they will be removed automatically.
    3. If the address entered ends with a `/` character, it will also be automatically removed.
    4. If the address entered has a space in the middle or is a non-address string, the submission will not succeed.

## Function interface

  It mainly describes how to evolve each interface displayed by the front end through the information returned by the extension interface `/api/v1/openapi.json` of OpenAPI-Plus. By describing the evolution of the generation process of the front-end interface, it makes it easier for people reading the ArkID front-end project to suggest or use it.

  The function interface mainly includes other functional pages except the login page, that is, the content page that can read data and add, delete, modify and query data information. The content and operation of specific pages requires a front-end knowledge base, such as TypeScript, Vue3, and Bootstrap5. This document will avoid covering the basics of any front end, but will simply give you a better understanding of how the front end and the back end work in general.

### Overview of issues

  How did these pages come about? The generation of the function page generally goes through the following steps.

1. Generating Front-End Routes from Router
2. Find the corresponding configuration details in the page configuration according to the page provided by the route
3. Generate the type page according to the page configuration, and find the pop-up page, cascade page and sub-page, as well as their corresponding operations (paths).
4. Find corresponding components according to the operation information, and generate page attributes according to the components
5. Mount the action on the page or button to complete the rendering of the page and the action of the button

!!! Hint
    1. Pop-up page: the dialog box page opened by the operation whose button type is open
    2. Cascade page: generally refers to the pointing page of cascade type operation in the node _ action description of the tree page.
    3. Sub-page: defined as pages declared in a page of type tabs/step, etc. Pointing to a page

### OpenAPI-Plus

The information and capabilities returned by OpenAPI-Plus through the interface `/api/v1/openapi.json` are briefly described below. Refer to the OpenAPI-Plus documentation for more details.

| 模块 | 名称 | 详情说明 |Whether the front end is used|
| --- | --- | --- | :---: |
| routers | 路由集 |Used by the front end to generate routing information| ✔ |
| pages | 页面集 |Used for front-end generation of different page types and page operations| ✔ |
| paths | 接口集 |Used to find Components, authority authentication, etc.| ✔ |
| components | 描述集 |Page element information for front-end generation| ✔ |
|permissions| 权限集 | 用于权限管理 | ✔ |
|translation| 国际化 | 用于国际化语音切换 | ✔ |
| info | 信息 |OpenAPI description| ✘ |
|openapi| 版本 | 版本号 | ✘ |

### Routing routers

  Routing information is provided by the OpenAPI-Plus interface. The front end will read the contents of this module directly and generate the front end routing table based on the routing description.

  In the process of generating the front-end routing table, it is necessary to process and mount the routing page permissions and some routing information. Routes are classified as with Children and without Children.

!!! Info "Prompt"
    1. A parent-child sidebar is generated when the number of Child routes Children is greater than or equal to 2
    2. When the child route Children is empty or the number is 1, the sidebar displays the page directly

```json title='无Children路由示例'
{
  "path": "mine",
  "name": "我的",
  "icon": "mine",
  "hidden": true,
  "page": "mine",
}
```


** Routing permissions **

  If information is provided `page` in an OpenAPI-Plus routing table, it means that the routing table needs to display a certain page, and it is necessary to determine whether the page has permission first. The permission set does not directly provide the permission of the page, but requires the front end to find the initialization interface of the page and indirectly determine the permission of the routing page through the interface.

  Route permission lookup steps (using the above example as an example):

1. In `page` the example above, you point to the mine page [页面配置](#pages) and find the init _ action in. If it is a cascading page and subpage (tabs/step) type, find the first subpage [页面配置](#pages) of the cascading page
2. Find [接口信息](#paths) the corresponding interface operationId in through the init _ action.
3. Find the corresponding sort _ ID value [权限集](#permissions) in operationId
4. Determine whether it has permission according to the string information returned by the sort _ ID value through the permission interface
5. If you have the route permission, it will be displayed; otherwise, it will not be displayed


** Display properties **

  In addition to the routing permission that needs the attention of the front end, the two display attributes provided by `mobile web` OpenAPI-Plus also need the corresponding processing of the front end.

  These two properties determine which routing pages are displayed on the mobile and Web sides. If the mobile attribute is specified, the corresponding routing information will be displayed at the bottom of the mobile page.

[![vZArBF.png](https://s1.ax1x.com/2022/08/03/vZArBF.png)](https://imgtu.com/i/vZArBF)


### Page configuration pages

  Page configuration items are mainly used to render the type and operation of the page. Complete rendering of the routing page is completed by reading the contents in the configuration items of the parsing page. The contents contained in the page configuration item have been described in detail in the OpenAPI-Plus document, and will not be repeated here.

The generated master page is shown in the following figure:

[![vZZlX6.png](https://s1.ax1x.com/2022/08/03/vZZlX6.png)](https://imgtu.com/i/vZZlX6)

The generated pop-up box page is shown in the following figure:

[![vZZYAe.png](https://s1.ax1x.com/2022/08/03/vZZYAe.png)](https://imgtu.com/i/vZZYAe)


!!! Info "Read Prompt"
    1. If it is a route declaration page and its cascade page, they are both main pages.
    2. The main page and other subpages (tabs/steps) use Card instead of Modal
    3. Both that mast page and the first subpage to which the master page is dependent require data to be initialize when the route is opened

Page configuration item reading steps:

1. Read the page configuration name, mount it to the front-end page, and hide the name if it is a main page and not a cascading page
2. Reading the init _ action information and obtaining the interface description according to the interface in the init _ action information
3. Read the rest of the action information and generate the corresponding action or button in the page
4. Then use the action information in the above two steps to complete the mounting of the page operation
5. Repeat the reading step to complete the configuration reading of all specified pages.

### Interface information paths

  For the front end, the interface information is mainly used to read the contents of the interface responses or requestBody and mount the operation contents, except for the operationId.

  Read responses when the action description `method=get` is in [页面配置](#pages); otherwise, read requestBody.

** Two read routes **

1. responses => 200 => content => application/json => schema => $ref
2. requestBody => content => application/json => schema => $ref

  
  And further reads the $ref pointing to it. For example `$ref=#/components/schemas/MineAppsOut`, it will be further described according to its `MineAppsOut` [属性描述](#components) operation.

[![vZQA2Q.png](https://s1.ax1x.com/2022/08/03/vZQA2Q.png)](https://imgtu.com/i/vZQA2Q)


### Property describes the components

  Parse and process the detailed information of the description in `components => schema => MineAppsOut` the attribute description.

  Mounting to different types of pages based on details `properties`, etc.

  Table tabular pages are mounted in table columns; form tabular pages are mounted in form items.

[![vZQZKs.png](https://s1.ax1x.com/2022/08/03/vZQZKs.png)](https://imgtu.com/i/vZQZKs)

### Permission set permissions

  The permission set is mainly used to control whether the front-end routing and API buttons are displayed.

  When there is no route or button permission information, the page will not display the corresponding content.

### International translation

  Page sample image:

[![vZQrxH.png](https://s1.ax1x.com/2022/08/03/vZQrxH.png)](https://imgtu.com/i/vZQrxH)

  Internationalization is mainly used for users to switch between languages. After switching, the page will be refreshed and updated, and the translated text provided by OpenAPI-Plus will be used to globally replace the location used by the page.
