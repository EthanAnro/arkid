# Develop the first plug-in

## Create plug-in directories and films
In the git repository of arkid under clone, find ** arkid.toml ** the file under the root directory and find the extension item. This configuration indicates the location of the file stored by the plug-in, as follows:
```toml
[extension]
root = ["./extension_root", "./my_extensions"]
```

Create a new folder under the ** my_extensions ** directory and name it: ** com_company_type_helloworld **

!!! Notice

In the Folder com _ company _ type _ HelloWorld, create a new films ** \_\_init\_\_.py **

In this way, the plug-in's body directory and body file are established.

## Write plug-in code (parse line by line)

Insert the following code in the ** \_\_init\_\_.py ** file:

```python linenums="1"

from arkid.core import extension,api,event  # (1)
from pydantic import Field

HELLOWORLD = 'HELLOWORLD' # (2)
package = 'com.company.type.helloworld' # (3)

HelloworldOutSchema = extension.create_extension_schema( # (11)
    'HelloworldOutSchema',
    package,
    fields = [
        ('data',str,Field())
    ]
)

class HelloworldExtension(extension.Extension): # (4)
    def load(self): # (5)
        super().load()
        
        self.register_api( # (10)
            '/helloworld_api/', 'GET', self.helloworld_api, 
            tags=['helloworld'], response=HelloworldOutSchema
        )
        
        hellowold_event_tag = self.register_event(HELLOWORLD, 'helloworld') # (6)
        self.listen_event(hellowold_event_tag, self.helloworld) # (7)

    def helloworld_api(self, request):
        event_results = event.dispatch_event(event.Event(package+'.'+HELLOWORLD, tenant=None, data='helloworld')) # (12)
        for fun, (result, ext) in event_results:
            return {'data':result}
        
    def helloworld(self, event, **kwargs): # (8)
        print(event.data) # (9)
        return event.data

extension = HelloworldExtension( # (13)
    package=package,
    description='my first extension',
    version='1.0',
    labels='hellowworld',
    homepage='https://arkid.cc',
    logo='',
    author='your-name@your-company.com',
)
```

1. The kernel code for ArkID is in the package arkid. Core, extension (various base classes related to plug-ins), API (encapsulated ninja API objects), event (all objects and methods related to events).
2. Event tag
3. The package of the plug-in should be defined separately because it is used repeatedly.
4. Define the plug-in and inherit the most basic plug-in base class Extension
5. The load () abstract method, the core startup method for all plug-ins, must be implemented
6. Events are registered in the plug-in. For event tag naming conflicts, it will be added ** package+'.' ** as a prefix before the incoming tag.
7. Add a callback function to listen for events
8. Define a callback function
9. Print the data parameter of the event
10. To define an API, refer to the documentation for django-ninja
11. Schema that defines the API. To avoid naming conflicts, only extension. Create _ extension _ schema methods can be used
12. Throw the event. Note that the tag of the event is the part that adds the prefix.
13. The singleton object of the plug-in is generated, and ArkID will obtain the extension object in the _ _ init _ _. Py file as the plug-in body

## Load and start plug-ins

Start Django

``` shell

python manager.py runserver
```
ArkID will automatically load all plug-ins in all plug-in directories in turn according to the configuration in the arkid. Toml file, and print out the loading information.


``` shell

Importing  my_extension/com_company_type_helloworld   
xxxx-xx-xx 03:21:57,944 - arkid - INFO - Imported  <module 'my_extension.com_company_type_helloworld' from '/arkid/my_extension/com_company_type_helloworld/__init__.py'>   
xxxx-xx-xx 03:21:57,944 - arkid - INFO - my_extension.com_company_type_helloworld import success   
```
After successful loading, if the plug-in is enabled, its ** load() ** function will be called to complete the startup. If the startup is successful, the following content will be printed:

``` shell

2022-xx-xx 03:22:00,993 - arkid - INFO - my_extension.com_company_type_helloworld load success  
```

## Check and Test Plug-in

Visit

``` shell
http://{ArkID host}/api/redoc#tag/helloworld/operation/my_extension_com_company_type_helloworld_helloworld
```

You can see that the API defined in the plug-in will be displayed in the document. Try to call the interface, and you can get the print:
``` shell

helloworld
[xx/xx/xxxx 03:22:07] "GET /api/v1/tenant/{tenant_id}/helloworld/ HTTP/1.1" 200 4
```
!!! Hint

