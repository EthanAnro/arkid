# Unify permissions
The arkid supports third-party applications. By outputting its own interface document, the arkid side can read the interface document of the application itself to manage permissions conveniently and flexibly in the arkid.

## Access step

1.You need to prepare a openapi. JSON access address that can be read. There must be at least a permissions node in JSON. The permissions must contain basic role information and interface information. An example with a permissions node is provided below as a reference:

``` json
{
    "permissions":[
        {
            "name":"customer",
            "sort_id":0,
            "type":"group",
            "container":[
                3,
                6
            ]
        },
        {
            "name":"tenant-admin",
            "sort_id":1,
            "type":"group",
            "container":[
                4
            ]
        },
        {
            "name":"platform-admin",
            "sort_id":2,
            "type":"group",
            "container":[
                5
            ]
        },
        {
            "name":"app列表",
            "sort_id":3,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_list_apps"
        },
        {
            "name":"创建应用",
            "sort_id":4,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_create_app"
        },
        {
            "name":"公开app列表",
            "sort_id":5,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_list_open_apps"
        },
        {
            "name":"获取app",
            "sort_id":6,
            "type":"api",
            "container":[

            ],
            "operation_id":"api_v1_views_app_get_app"
        }
    ]
}
```

| 参数名称        |Parameter description|
| :---------:    | :--------------: |
| `name` | Name |
| `sort_id` |Sorting ID (generated by the developer)|
| `type` |Type (API or group)|
| `container` |Contains the sort _ ID of the interface (value only in group type)|
| `operation_id` |Operation ID (this field is only available for API types)|

2.You need to create an application in the application list under the application management menu

[![ vlq2Ct.md.jpg ](https://s1.ax1x.com/2022/08/09/vlq2Ct.md.jpg)](https://imgtu.com/i/vlq2Ct)

3.It is necessary to configure the protocol for the application. Here, the OIDC type application is taken as an example.

[![ vlL1RP.md.jpg ](https://s1.ax1x.com/2022/08/09/vlL1RP.md.jpg)](https://imgtu.com/i/vlL1RP)

``` title="补充说明"
目前只支持OIDC类型，或者Oauth2类型的应用。其它类型的应用无法使用获取权限字符串的功能
```

4.Requires open API configuration for the application

[![ vlLysU.md.jpg ](https://s1.ax1x.com/2022/08/09/vlLysU.md.jpg)](https://imgtu.com/i/vlLysU)

``` title="补充说明"
如果接口文档中的permissions内容有变更，需要更改应用版本，第一次配置时除外
```
## How to use

1.The read permissions can be authorized to other tenants in all application pages under the permission management menu and the authorization management menu.

[![ vljsQP.md.jpg ](https://s1.ax1x.com/2022/08/09/vljsQP.md.jpg)](https://imgtu.com/i/vljsQP)

``` title="补充说明"
权限的分配是逐级向下的，一般授权开启时，除要开启的权限外，会打开应用入口权限，防止其它租户的用户无法进行登录
授权开启:该权限被授权给其它租户使用，其它租户的管理员是最先拥有该权限的，其它租户管理员可以对自己拥有的权限进行二次分配。
授权关闭:该权限如果从开启状态切换到关闭状态，则已经分配给其它租户的权限，将被收回，包括其它租户二次分配的。
```

2.In addition to authorizing other tenants to use, user rights can also be granted within the tenant.

[![ vlvrtJ.md.jpg ](https://s1.ax1x.com/2022/08/09/vlvrtJ.md.jpg)](https://imgtu.com/i/vlvrtJ)

## How to Get the Permission String for a User

1.Access the application list, edit the application, and obtain the parameter information

[![ v3A13T.md.jpg ](https://s1.ax1x.com/2022/08/10/v3A13T.md.jpg)](https://imgtu.com/i/v3A13T)

| 英文参数名称        |Corresponding page field|
| :---------:    | :----------------------------------: |
| `redirect url`| 回调地址  |
| `client_id`| 客户端id  |
| `client_token`| 客户端秘钥 |
| `authorize url`| 授权url |
| `get token url` |Get access _ token addr|
| `userinfo url`| 用户信息地址 |
| `logout url`| 退出登录地址 |

2.Get Authorization Code

- Request Address:
- Request method: GET
- Request Parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `client_id` | `client_id` |
| `redirect_uri` | `redirect url` |
| `response_type` | Fill in code | code
| `scope`        |Fill in (openid user info)|

- Request example: http://authorize  URL/? client_id=xxxxx&redirect_uri=xxxxx&response_type=code&scope=userinfo
- Return parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `code` | Authorization Code |

- Return example:

3.Get Access Token

- Request Address:
- Request method: POST
- Request header parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `Authorization` | Token format is client _ ID: client _ secret uses base64 encoding | Basic token
| `Content-Type` |Fill in multipart/form-data|

- Request Parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `code` | Authorization Code |
| `grant_type` |Fill in authorization _ code|


- Request example:

[![ XoX9Z4.md.jpg ](https://s1.ax1x.com/2022/06/15/XoX9Z4.md.jpg)](https://imgtu.com/i/XoX9Z4)

- Return parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `access_token` | Token |
| `expires_in`| 过期时间 |
| `token_type`| Bearer |
| `scope` |userinfo openid|
| `refresh_token`| 用于更新令牌的令牌 |
| `id_token`| id_token |

- Return example:
``` json
{
    "access_token": "nRmo1Ko5UbStrtBNtySnUi8Ezw9YBm",
    "expires_in": 36000,
    "token_type": "Bearer",
    "scope": "openid userinfo",
    "refresh_token": "na3bP6WX3JzZynqLSJS8wI4m6zWiC9",
    "id_token": "eyJhbGciOiAiUlMyNTYiLCAidXNlIjogInNpZyIsICJraWQiOiAiRjlYSlg3N0VkTjVnNnA5Q3ZnS1NnTW9GRTh4cjNJeWp6aUNLTnR3enhWTSIsICJlIjogIkFRQUIiLCAia3R5IjogIlJTQSIsICJuIjogImlFNFkyMDhLV0x1QzhLcWZLQU96NmctaUlfeHNLU3hTYmoyMWxXbmdnMmwtay01b2ZKaVRDQklKZjFTR1dyQ3hfRXNGT1ptZUxEM29xcE96WUNhdFZ3NlBlNnVacFJhRFZSekFoOV9Da00waUFWclc2bHB4QkowSFlxZ1d3cHBpSG15M2VEbkg2V3lGVkNQUFhKd3F1MU5ETlludENqcUtWa2gxamotdjktVSJ9.eyJhdWQiOiAiQXJkeHJwajVVb0JmUUNiN1F4TDE1RG9YR2ozcHpOeHFkeFl2U1YxeCIsICJpYXQiOiAxNjYwMTE1MDU4LCAiYXRfaGFzaCI6ICJqa19ET1M0MFNnT3Fubk91QzhjeHdnIiwgInN1YiI6ICJmYWY1YWFlNi0zY2RmLTQ1OTUtOGI0YS0zYTA2YjMxMTE3YzgiLCAic3ViX2lkIjogImZhZjVhYWU2LTNjZGYtNDU5NS04YjRhLTNhMDZiMzExMTdjOCIsICJwcmVmZXJyZWRfdXNlcm5hbWUiOiAiYWRtaW4iLCAiZ3JvdXBzIjogWyJ0ZW5hbnRfYWRtaW4iXSwgInRlbmFudF9pZCI6ICI0ZGExMTRjZS1lMTE1LTQ0YTAtODIzYi1kMzcyMTE0NDI1ZDAiLCAidGVuYW50X3NsdWciOiAiIiwgImlzcyI6ICJodHRwOi8vbG9jYWxob3N0OjgwMDAvYXBpL3YxL3RlbmFudC80ZGExMTRjZS1lMTE1LTQ0YTAtODIzYi1kMzcyMTE0NDI1ZDAiLCAiZXhwIjogMTY2MDE1MTA1OCwgImF1dGhfdGltZSI6IDE2NjAxMTUwNTh9.Xcz9d79UdPAVtiObwkauIPVodQtDK8ZX9zYBhTgmjs5_lQhlgzCeUZPeUJCsIb_3AR9BChDw_EDYzwFhg1h4vYofYlRk4V9wHZypbRoDFopm343h78JbzGeexFiRhE_e4zIPmVsQj925TpMuMOP4zLKX3U6pTPJETflrvblXcUs"
}
```

4.Gets the permission string

- Request Address:
- Request method: GET
- Request header parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `ID-TOKEN` | Get the ID _ token returned by the access _ token interface | xxxxx

- Return parameters:

| 参数名称        |Parameter description| 示例           |
| :---------:    | :--------------: | :--------------: |
| `result`    |User permission string (1 is permission, 0 is no permission, and each bit corresponds to sort _ ID in the interface document)|

- Return example:
``` json
{
    "result":"11111"
}
```